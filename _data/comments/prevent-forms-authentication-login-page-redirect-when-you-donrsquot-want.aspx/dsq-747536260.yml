id: dsq-747536260
date: 2011-10-08T08:20:06.0000000-07:00
author: Jarrett Vance
email: jarrettv@gmail.com
gravatar: 8cc8bab6c39b2d33a48ccf1146d5fb17
message: <p>The last part of this post is hilarious:<br><em>Why donâ€™t you just fix the FormsAuthenticationModule?</em><br>I look forward to this being fixed in 4.5... please!<br>Here is my ugly solution in <strong>Application_Error</strong>:<br><code><br>// read error page from config<br>string redirectUrl = null;<br>if (this.Context.IsCustomErrorEnabled)<br>{<br>    var section = WebConfigurationManager.GetSection("system.web/customErrors") as CustomErrorsSection;<br>    if (section != null) {<br>        redirectUrl = section.DefaultRedirect;<br>        if (section.Errors.Count &gt; 0) {<br>            CustomError item = section.Errors[statusCode.ToString()];<br>            if (item != null) redirectUrl = item.Redirect;<br>        }<br>    }<br>    // load error page<br>    this.Context.Response.Clear();<br>    this.Context.Response.StatusCode = statusCode;<br>    this.Context.Response.TrySkipIisCustomErrors = true;<br>    this.Context.ClearError();<br>    // ** do not redirect when ajax **<br>    if ((this.Context.Request["X-Requested-With"] == "XMLHttpRequest") || <br>        ((this.Context.Request.Headers != null) &amp;&amp; (this.Context.Request.Headers["X-Requested-With"] == "XMLHttpRequest")))<br>        return;<br>    // only redirect if there is a url<br>    if (!string.IsNullOrEmpty(redirectUrl))<br>    {<br>        this.Context.Response.Redirect(redirectUrl);<br>    }<br>}</code></p>
